<!DOCTYPE html>
<html>

<head>
  <title>Upload de Arquivo Excel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
  <h2>Faça o upload do seu arquivo Excel</h2>
  <input type="file" id="fileInput" accept=".xlsx, .xls">
  <button onclick="uploadFile()">Upload</button>
  <div id="response"></div>
  <h2>Dados do Excel</h2>
  <table id="excelTable" border="1">
    <thead id="tableHead"></thead>
    <tbody id="tableBody"></tbody>
  </table>

  <h2>Faça uma consulta</h2>
  <input type="text" id="queryInput" placeholder="Digite sua consulta">
  <button onclick="submitQuery()">Consultar</button>
  <div id="queryResponse"></div>

  <script>
    let excelData = [];

    function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

          displayExcelData(excelData);
          document.getElementById('response').innerText = 'File uploaded successfully';
        };
        reader.readAsArrayBuffer(file);
      } else {
        document.getElementById('response').innerText = 'No file selected';
      }
    }

    function displayExcelData(data) {
      const tableHead = document.getElementById('tableHead');
      const tableBody = document.getElementById('tableBody');

      tableHead.innerHTML = "";
      tableBody.innerHTML = "";

      if (data.length > 0) {
        const headers = data[0];
        const headerRow = document.createElement('tr');
        headers.forEach(header => {
          const th = document.createElement('th');
          th.innerText = header;
          headerRow.appendChild(th);
        });
        tableHead.appendChild(headerRow);

        data.slice(1).forEach(row => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const td = document.createElement('td');
            td.innerText = cell;
            tr.appendChild(td);
          });
          tableBody.appendChild(tr);
        });
      }
    }

    function submitQuery() {
      const query = document.getElementById('queryInput').value;
      axios.post('YOUR_BACKEND_ENDPOINT', {
        query: query,
        data: excelData
      })
        .then(response => {
          document.getElementById('queryResponse').innerText = response.data.response;
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('queryResponse').innerText = 'Error fetching response';
        });
    }
  </script>
</body>

</html>